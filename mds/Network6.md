# 네트워크 6강

### IP 프로토콜



## IPv4 프로토콜

#### 하는 일

네트워크에서 데이터를 교환하기 위한 프로토콜 (장거리로 전달)

정확하게 전달될 것을 보장해 주지는 않음 -> 더 상위 프로토콜인 TCP의 역할



#### 구조

20 byte + @ (최대 60byte지만 사실상 20 byte이다)

Source/Destination Address (4byte) : 출발지/목적지 주소

Version(4bit) : 그냥 4가 옴 (IPv6은 다른 구조)

IHL(Header Length) : 실제 크기(byte)/4를 적음, 마찬가지로 사실상 5가 옴

TOS(1byte) : 현재는 쓰지 않아서 0으로 둠

Total Length(2byte) : 페이로드까지 전부 합친 전체의 길이

Identification : 조각난 데이터를 다시 합칠 때 구분 용도로 활용, 그것을 구분할 때의 ID값

IP Flags(3bit) : 첫 비트는 안 씀, D비트도 거의 못 씀, M비트는 최대 전송 단위보다 클 때 쪼개는지 여부를 표시

Fragment Offset(13bit) : 받는 순서는 보낸 순서대로 가지 않을 수 있음, 따라서 각 조각의 offset 값을 기록해둠

TTL(1byte) : Time To Live, 패킷이 잘못해서 떠도는 경우를 방지, 숫자값을 지정해서 3계층 장비를 넘어갈 때마다 1씩 줄어들다가 0이 되면 바로 버려버림, 윈도우 : 128 / 리눅스 : 64

Protocol(1byte) : 상위 프로토콜 타입, 3계층의 ICMP가 뒤에 오면 01, 4계층의 TCP가 오면 06, UDP가 오면 17(16진수면 11)

Header Checksum(1byte) : Header가 잘 되어 있는지 계산해서 체크

IP Option (가변 길이, 4byte씩 10개까지 올수 있음) : 잘 안쓰임



## ICMP 프로토콜

#### 하는 일

운영체제에서 오류 메시지를 전송 받는데 주로 사용됨.

프로토콜 구조의 Type과 Code를 통해 오류 메시지를 전송받음



#### 구조

Checksum은 마찬가지로 헤더가 오류가 있는지 체크 용

Type, Code (각 1byte) : Type은 Category 대분류, Code는 소분류

중요 Type들 : 0(응답), 8(요청), 3(목적지 도달 x), 11(요청 시간 만료, 상대방의 응답이 안 옴), 5(보안상 중요, 라우팅 테이블 변경)



## 라우팅 테이블

#### 역할

패킷이 갈 최적의 경로를 기록해 둠, **지도** 역할

따라서 라우팅 테이블에 경로가 있어야 패킷을 전송할 수 있음

"netstat -r"로 확인 가능



## 다른 네트워크와 통신 과정

#### 라우팅 테이블에 경로가 있는 경우

Eth - IPv4 - ICMP 요청 프로토콜(8)을 작성해서 보냄

이 때 Ethernet의 목적지 MAC주소는 게이트웨이 주소

게이트웨이에서 Ethernet을 다시 작성해서 보냄

라우터에서 Ethernet을 또 다시 작성하고 보냄

이 과정을 반복하여 목적지에 도달



## IPv4의 조각화

